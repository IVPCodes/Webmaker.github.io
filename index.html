<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>INDOVP Discord Sim</title>
<style>
body{margin:0;font-family:Arial,sans-serif;background:#181818;color:#eee;}
.container{max-width:1000px;margin:0 auto;padding:20px;}
input,textarea,select{margin:4px 0;padding:6px;border-radius:4px;border:none;}
button{padding:6px 10px;border:none;border-radius:4px;background:#2a6cf4;color:white;cursor:pointer;margin:2px;}
button:hover{background:#1d4bd1;}
#chatInterface{display:none;}
.chatBox{height:300px;overflow-y:auto;background:#222;padding:10px;border-radius:8px;margin-bottom:6px;}
.serverList, .channelList, .friendList, .dmList{margin-bottom:10px;}
.message{margin-bottom:4px;}
.ownerMessage{color:gold;}
</style>
</head>
<body>
<div class="container">
<h1>INDOVP Discord Sim</h1>

<div id="login">
<h2>Login / Register</h2>
<label>Username: <input type="text" id="username"></label><br>
<label>Password: <input type="password" id="password"></label><br>
<button onclick="login()">Login</button>
<button onclick="register()">Register</button>
</div>

<div id="chatInterface">
<h3>Servers</h3>
<div class="serverList" id="serverList"></div>

<h3>Channels</h3>
<div class="channelList" id="channelList"></div>

<h3>Chat</h3>
<div class="chatBox" id="chatBox"></div>
<input type="text" id="messageInput" placeholder="Type message...">
<button onclick="sendMessage()">Send</button>

<h3>Friends</h3>
<div class="friendList" id="friendList"></div>
<input type="text" id="addFriendInput" placeholder="Friend Username">
<button onclick="addFriend()">Add Friend</button>

<h3>DMs</h3>
<div class="dmList" id="dmList"></div>
<input type="text" id="dmInput" placeholder="Select friend and type message...">
<button onclick="sendDM()">Send DM</button>
</div>
</div>

<script>
let users=[{username:'Sigma',password:'123',friends:[]}];
let currentUser=null;
let ownerMode=false;

// Servers & Channels
let servers=[{name:'Main Server',channels:[{name:'general',messages:[]}]}];
let currentServer=servers[0];
let currentChannel=currentServer.channels[0];
let currentDMUser=null;

// Login/Register
function register(){
  let u=document.getElementById('username').value.trim();
  let p=document.getElementById('password').value.trim();
  if(!u||!p){alert('Enter username & password'); return;}
  if(users.find(x=>x.username===u)){alert('Username taken'); return;}
  users.push({username:u,password:p,friends:[]});
  alert('Registered! Now login.');
}

function login(){
  let u=document.getElementById('username').value.trim();
  let p=document.getElementById('password').value.trim();
  let user=users.find(x=>x.username===u && x.password===p);
  if(!user){alert("Invalid login");return;}
  currentUser=user;
  document.getElementById('login').style.display='none';
  document.getElementById('chatInterface').style.display='block';
  renderServers();
  renderChannels();
  renderChat();
  renderFriendList();
  renderDMList();
}

// Owner Konami code
const konami=[38,38,40,40,37,39,37,39,66,65];
let kIndex=0;
document.addEventListener('keydown',e=>{
  if(e.keyCode===konami[kIndex]){
    kIndex++;
    if(kIndex===konami.length){
      ownerMode=true;
      kIndex=0;
      alert('Owner Mode activated!');
    }
  } else kIndex=0;
});

// Render
function renderServers(){
  const div=document.getElementById('serverList');
  div.innerHTML='';
  servers.forEach((s,i)=>{
    let btn=document.createElement('button');
    btn.innerText=s.name;
    btn.onclick=()=>{currentServer=s; currentChannel=s.channels[0]; renderChannels(); renderChat();}
    div.appendChild(btn);
  });
}

function renderChannels(){
  const div=document.getElementById('channelList');
  div.innerHTML='';
  currentServer.channels.forEach((c,i)=>{
    let btn=document.createElement('button');
    btn.innerText=c.name;
    btn.onclick=()=>{currentChannel=c; renderChat();}
    div.appendChild(btn);
  });
}

function renderChat(){
  const div=document.getElementById('chatBox');
  div.innerHTML='';
  currentChannel.messages.forEach(m=>{
    let msg=document.createElement('div');
    msg.className='message';
    if(m.sender==='Owner' && ownerMode) msg.className+=' ownerMessage';
    msg.innerText=`${m.sender}: ${m.text}`;
    div.appendChild(msg);
  });
  div.scrollTop=div.scrollHeight;
}

// Messaging
function sendMessage(){
  let msg=document.getElementById('messageInput').value.trim();
  if(!msg) return;
  if(msg==='/owner') ownerMode=true;
  currentChannel.messages.push({sender:ownerMode?'Owner':currentUser.username,text:msg});
  document.getElementById('messageInput').value='';
  renderChat();
}

// Friends
function addFriend(){
  let f=document.getElementById('addFriendInput').value.trim();
  if(!f||f===currentUser.username){alert("Can't add yourself"); return;}
  let friend=users.find(u=>u.username===f);
  if(!friend){alert("User not found"); return;}
  if(currentUser.friends.includes(f)){alert("Already friends"); return;}
  currentUser.friends.push(f);
  renderFriendList();
  alert('Friend added!');
}

function renderFriendList(){
  const div=document.getElementById('friendList');
  div.innerHTML='';
  currentUser.friends.forEach(f=>{
    let btn=document.createElement('button');
    btn.innerText=f;
    btn.onclick=()=>{currentDMUser=f; renderDMList();}
    div.appendChild(btn);
  });
}

// DMs
let dms={}; // key: username, value: {otherUser: messages[]}
function sendDM(){
  if(!currentDMUser){alert('Select friend first'); return;}
  let msg=document.getElementById('dmInput').value.trim();
  if(!msg) return;
  if(!dms[currentUser.username]) dms[currentUser.username]={};
  if(!dms[currentUser.username][currentDMUser]) dms[currentUser.username][currentDMUser]=[];
  if(!dms[currentDMUser]) dms[currentDMUser]={};
  if(!dms[currentDMUser][currentUser.username]) dms[currentDMUser][currentUser.username]=[];
  let sender=currentUser.username;
  if(ownerMode) sender='Owner';
  dms[currentUser.username][currentDMUser].push({sender,text:msg});
  dms[currentDMUser][currentUser.username].push({sender,text:msg});
  document.getElementById('dmInput').value='';
  renderDMList();
}

function renderDMList(){
  const div=document.getElementById('dmList');
  div.innerHTML='';
  if(!currentDMUser) return;
  const msgs=dms[currentUser.username]?.[currentDMUser]||[];
  msgs.forEach(m=>{
    let msg=document.createElement('div');
    msg.className='message';
    if(m.sender==='Owner' && ownerMode) msg.className+=' ownerMessage';
    msg.innerText=`${m.sender}: ${m.text}`;
    div.appendChild(msg);
  });
  div.scrollTop=div.scrollHeight;
}

// Auto-update chat every second
setInterval(()=>{
  if(currentChannel) renderChat();
  if(currentDMUser) renderDMList();
},1000);
</script>
</body>
</html>
