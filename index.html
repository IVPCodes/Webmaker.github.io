<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>INDOVP Discord Clone</title>
<style>
body{margin:0;font-family:Arial,sans-serif;background:#121212;color:#eee;}
.container{max-width:1000px;margin:0 auto;padding:20px;}
h1,h2,h3{margin:0 0 10px;}
#login, #chatInterface{margin-bottom:20px;}
input,button,select,textarea{margin:5px 0;padding:6px;}
button{cursor:pointer;}
.server, .channel, .message{border:1px solid #444;padding:6px;margin:4px 0;border-radius:6px;}
.server.active, .channel.active{background:#2a6cf4;color:white;}
.message.owner{background:#333;}
.message.user{background:#222;}
.message span.user{font-weight:bold;}
.owner-btns button{font-size:12px;margin-left:4px;}
</style>
</head>
<body>
<div class="container">
<h1>INDOVP Discord Clone</h1>

<div id="login">
<h2>Login / Register</h2>
<label>Username: <input type="text" id="username"></label><br>
<label>Password: <input type="password" id="password"></label><br>
<button onclick="register()">Register</button>
<button onclick="login()">Login</button>
<p id="loginMsg"></p>
</div>

<div id="chatInterface" style="display:none;">
<h2>Servers</h2>
<div id="serverList"></div>
<input type="text" id="newServerName" placeholder="New Server Name">
<button onclick="createServer()">Create Server</button>

<h2>Channels</h2>
<div id="channelList"></div>
<input type="text" id="newChannelName" placeholder="New Channel Name">
<button onclick="createChannel()">Create Channel</button>

<h2>Chat (<span id="currentServer"></span> - <span id="currentChannel"></span>)</h2>
<div id="messages" style="height:300px;overflow-y:auto;border:1px solid #444;padding:6px;"></div>
<input type="text" id="chatInput" placeholder="Type a message">
<button onclick="sendMessage()">Send</button>

<p id="ownerMsg"></p>
</div>
</div>

<script>
// ----- Data -----
let users = JSON.parse(localStorage.getItem('users'))||[];
let servers = JSON.parse(localStorage.getItem('servers'))||[];
let currentUser=null;
let currentServer=null;
let currentChannel=null;
let ownerMode=false;

// ----- Auth -----
function register(){
    let u=document.getElementById('username').value.trim();
    let p=document.getElementById('password').value.trim();
    if(!u||!p){alert("Enter username and password");return;}
    if(users.find(x=>x.username===u)){alert("Username exists");return;}
    users.push({username:u,password:p,owner:false});
    localStorage.setItem('users',JSON.stringify(users));
    document.getElementById('loginMsg').innerText="Registered! Login now.";
}
function login(){
    let u=document.getElementById('username').value.trim();
    let p=document.getElementById('password').value.trim();
    let user=users.find(x=>x.username===u && x.password===p);
    if(!user){alert("Invalid login");return;}
    currentUser=user;
    document.getElementById('login').style.display='none';
    document.getElementById('chatInterface').style.display='block';
    renderServers();
    renderChannels();
    renderMessages();
}

// ----- Server / Channels -----
function createServer(){
    let name=document.getElementById('newServerName').value.trim();
    if(!name)return;
    let s={id:Date.now(),name:name,channels:[],messages:{}};
    servers.push(s);
    localStorage.setItem('servers',JSON.stringify(servers));
    document.getElementById('newServerName').value='';
    renderServers();
}
function createChannel(){
    if(!currentServer){alert("Select a server"); return;}
    let name=document.getElementById('newChannelName').value.trim();
    if(!name)return;
    currentServer.channels.push({name:name});
    currentServer.messages[name]=[];
    localStorage.setItem('servers',JSON.stringify(servers));
    document.getElementById('newChannelName').value='';
    renderChannels();
}
function renderServers(){
    const div=document.getElementById('serverList'); div.innerHTML='';
    servers.forEach(s=>{
        let b=document.createElement('div'); b.className='server'+(s===currentServer?' active':'');
        b.innerText=s.name; b.onclick=()=>{currentServer=s;currentChannel=null;renderServers(); renderChannels(); renderMessages();}
        div.appendChild(b);
    });
    document.getElementById('currentServer').innerText=currentServer?currentServer.name:'None';
}
function renderChannels(){
    const div=document.getElementById('channelList'); div.innerHTML='';
    if(!currentServer) return;
    currentServer.channels.forEach(c=>{
        let b=document.createElement('div'); b.className='channel'+(c===currentChannel?' active':'');
        b.innerText=c.name; b.onclick=()=>{currentChannel=c;renderChannels(); renderMessages();}
        div.appendChild(b);
    });
    document.getElementById('currentChannel').innerText=currentChannel?currentChannel.name:'None';
}

// ----- Chat -----
function sendMessage(){
    if(!currentServer||!currentChannel)return;
    let msg=document.getElementById('chatInput').value.trim();
    if(!msg)return;
    if(msg==='/owner'){ownerMode=true; alert('Owner mode enabled');document.getElementById('ownerMsg').innerText='Owner Mode'; document.getElementById('chatInput').value=''; return;}
    currentServer.messages[currentChannel.name].push({user:currentUser.username,content:msg,owner:ownerMode});
    localStorage.setItem('servers',JSON.stringify(servers));
    document.getElementById('chatInput').value='';
    renderMessages();
}
function renderMessages(){
    const div=document.getElementById('messages'); div.innerHTML='';
    if(!currentServer||!currentChannel) return;
    currentServer.messages[currentChannel.name].forEach((m,i)=>{
        let d=document.createElement('div'); d.className='message '+(m.owner?'owner':'user');
        d.innerHTML=`<span class="user">${m.user}:</span> ${m.content}`;
        if(ownerMode){
            let del=document.createElement('button'); del.innerText='Delete'; del.className='small';
            del.onclick=()=>{currentServer.messages[currentChannel.name].splice(i,1); localStorage.setItem('servers',JSON.stringify(servers)); renderMessages();}
            d.appendChild(del);
        }
        div.appendChild(d);
    });
}
</script>
</body>
</html>
