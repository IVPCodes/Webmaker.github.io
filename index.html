<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>INDOVP Mini Discord</title>
<style>
body {margin:0;font-family:Arial,sans-serif;background:#18191c;color:#eee;}
#login, #chatInterface {max-width:1000px;margin:20px auto;padding:20px;background:#242529;border-radius:10px;}
input, button, select, textarea {margin:5px 0;padding:6px;border-radius:5px;border:none;}
button {cursor:pointer;background:#2a6cf4;color:white;}
button:hover{background:#1d4bd1;}
#servers {float:left;width:20%;background:#2f3136;padding:10px;height:400px;overflow:auto;}
#channels {float:left;width:20%;background:#2f3136;padding:10px;height:400px;overflow:auto;}
#chat {float:left;width:55%;background:#36393f;padding:10px;height:400px;overflow:auto;}
#friends {float:right;width:20%;background:#2f3136;padding:10px;height:400px;overflow:auto;}
.clearfix::after {content:"";clear:both;display:table;}
.message {margin-bottom:5px;padding:4px;border-bottom:1px solid #444;}
.owner {color:gold;}
.dm {color:#2a6cf4;}
</style>
</head>
<body>

<div id="login">
<h2>Login</h2>
<label>Username: <input type="text" id="username"></label><br>
<label>Password: <input type="password" id="password"></label><br>
<button onclick="login()">Login</button>
</div>

<div id="chatInterface" style="display:none;">
<div class="clearfix">
<div id="servers"><h3>Servers</h3></div>
<div id="channels"><h3>Channels</h3></div>
<div id="chat"><h3>Chat</h3></div>
<div id="friends"><h3>Friends</h3></div>
</div>
<input type="text" id="chatInput" placeholder="Type a message...">
<button onclick="sendMessage()">Send</button>
</div>

<script>
// --- Users & Login ---
let users=[{username:'Sigma',password:'123'},{username:'Player1',password:'abc'}];
let currentUser=null;
let ownerMode=false;

// --- Servers & Channels ---
let servers=[
  {id:1,name:'General',roles:['admin','mod','member'],messages:[],channels:[
    {id:1,name:'general',messages:[]},{id:2,name:'random',messages:[]}
  ]}
];
let currentServer=null;
let currentChannel=null;

// --- Friends & DMs ---
let friends=[];
let dms=[]; // {user:'Player1',messages:[]}

// --- Login ---
function login(){
    let u=document.getElementById('username').value.trim();
    let p=document.getElementById('password').value.trim();
    let user=users.find(x=>x.username===u && x.password===p);
    if(!user){alert("Invalid login");return;}
    currentUser=user;
    document.getElementById('login').style.display='none';
    document.getElementById('chatInterface').style.display='block';
    renderServers();
    renderChannels();
    renderMessages();
    renderFriendList();
    renderDMList();

    // Auto-update messages every second
    setInterval(()=>{
        if(currentServer && currentChannel){ renderMessages(); }
        renderDMList();
    },1000);
}

// --- Render Servers ---
function renderServers(){
    const div=document.getElementById('servers');
    div.innerHTML='<h3>Servers</h3>';
    servers.forEach(s=>{
        const btn=document.createElement('button');
        btn.innerText=s.name;
        btn.onclick=()=>{ currentServer=s; currentChannel=s.channels[0]; renderChannels(); renderMessages(); };
        div.appendChild(btn);
    });
}

// --- Render Channels ---
function renderChannels(){
    const div=document.getElementById('channels');
    div.innerHTML='<h3>Channels</h3>';
    if(!currentServer) return;
    currentServer.channels.forEach(c=>{
        const btn=document.createElement('button');
        btn.innerText=c.name;
        btn.onclick=()=>{ currentChannel=c; renderMessages(); };
        div.appendChild(btn);
    });
}

// --- Render Messages ---
function renderMessages(){
    const div=document.getElementById('chat');
    div.innerHTML='<h3>Chat</h3>';
    if(!currentChannel) return;
    currentChannel.messages.forEach(m=>{
        const msg=document.createElement('div');
        msg.className='message';
        msg.innerHTML=`<strong>${m.user}</strong>: ${m.text}`;
        if(m.owner) msg.classList.add('owner');
        div.appendChild(msg);
    });
    div.scrollTop=div.scrollHeight;
}

// --- Send Message ---
function sendMessage(){
    if(!currentChannel) return;
    const input=document.getElementById('chatInput');
    const text=input.value.trim();
    if(!text) return;
    let msg={user:currentUser.username,text:text,owner:false};
    if(text==='/owner'){ownerMode=true; msg.owner=true; alert('Owner mode activated!');}
    if(ownerMode) msg.owner=true;
    currentChannel.messages.push(msg);
    input.value='';
    renderMessages();
}

// --- Friends ---
function renderFriendList(){
    const div=document.getElementById('friends');
    div.innerHTML='<h3>Friends</h3>';
    friends.forEach(f=>{
        const btn=document.createElement('button');
        btn.innerText=f.username;
        btn.onclick=()=>{ openDM(f.username); };
        div.appendChild(btn);
    });
}

// --- DMs ---
function openDM(friendName){
    let dm=dms.find(x=>x.user===friendName);
    if(!dm){dm={user:friendName,messages:[]}; dms.push(dm);}
    currentChannel=null;
    const div=document.getElementById('chat');
    div.innerHTML=`<h3>DM with ${friendName}</h3>`;
    dm.messages.forEach(m=>{
        const msg=document.createElement('div');
        msg.className='message dm';
        msg.innerHTML=`<strong>${m.user}</strong>: ${m.text}`;
        div.appendChild(msg);
    });
    div.scrollTop=div.scrollHeight;
    const input=document.getElementById('chatInput');
    input.onkeydown=(e)=>{
        if(e.key==='Enter'){
            let text=input.value.trim();
            if(!text) return;
            dm.messages.push({user:currentUser.username,text:text});
            if(ownerMode){console.log(`Owner sees DM: ${currentUser.username} -> ${friendName}: ${text}`);}
            input.value='';
            renderDMList();
            openDM(friendName);
        }
    }
}

// --- Render DM List ---
function renderDMList(){
    const div=document.getElementById('friends');
    div.innerHTML='<h3>Friends</h3>';
    friends.forEach(f=>{
        const btn=document.createElement('button');
        btn.innerText=f.username;
        btn.onclick=()=>{ openDM(f.username); };
        div.appendChild(btn);
    });
}

// --- Add Friend ---
function addFriend(username){
    if(!users.find(u=>u.username===username)){alert('No such user'); return;}
    if(friends.find(f=>f.username===username)){alert('Already friends'); return;}
    friends.push({username:username});
    renderFriendList();
}
</script>
</body>
</html>
